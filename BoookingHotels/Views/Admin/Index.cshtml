@{
    ViewData["Title"] = "Admin Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body {
        background: #f6f8fa;
    }

    .dashboard-title {
        font-size: 2.2rem;
        font-weight: 800;
        color: #2d3748;
        letter-spacing: -1px;
    }

    .dashboard-card {
        border: none;
        border-radius: 1.25rem;
        padding: 2rem 1.25rem 1.25rem 1.25rem;
        color: #22223b;
        background: #fff;
        box-shadow: 0 4px 24px rgba(60,72,88,0.08);
        transition: transform .18s, box-shadow .18s;
        position: relative;
        min-height: 170px;
    }

        .dashboard-card:hover {
            transform: translateY(-4px) scale(1.03);
            box-shadow: 0 8px 32px rgba(60,72,88,0.13);
            z-index: 2;
        }

    .dashboard-icon {
        font-size: 2.2rem;
        color: #fff;
        background: linear-gradient(135deg, #6366f1, #3b82f6);
        border-radius: 50%;
        width: 3.5rem;
        height: 3.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem auto;
        box-shadow: 0 2px 8px rgba(99,102,241,0.12);
    }

    .dashboard-label {
        font-size: 1.05rem;
        font-weight: 600;
        color: #6b7280;
        margin-bottom: 0.25rem;
        letter-spacing: 0.5px;
    }

    .dashboard-value {
        font-size: 2.1rem;
        font-weight: 800;
        color: #22223b;
        margin-bottom: 0.5rem;
    }

    .dashboard-card .btn {
        border-radius: 2rem;
        font-weight: 600;
        font-size: 0.95rem;
        padding: 0.35rem 1.2rem;
        margin-top: 0.5rem;
        background: #f6f8fa;
        color: #6366f1;
        border: none;
        transition: background .15s;
    }

        .dashboard-card .btn:hover {
            background: #e0e7ff;
            color: #3730a3;
        }

    .dashboard-card.bg-gradient-hotels .dashboard-icon {
        background: linear-gradient(135deg, #34d399, #059669);
    }

    .dashboard-card.bg-gradient-rooms .dashboard-icon {
        background: linear-gradient(135deg, #fbbf24, #d97706);
    }

    .dashboard-card.bg-gradient-amenities .dashboard-icon {
        background: linear-gradient(135deg, #f472b6, #db2777);
    }

    .dashboard-card.bg-gradient-vouchers .dashboard-icon {
        background: linear-gradient(135deg, #ec4899, #be185d);
    }

    .dashboard-card.bg-gradient-bookings .dashboard-icon {
        background: linear-gradient(135deg, #3b82f6, #1e40af);
    }

    .dashboard-card.bg-gradient-users .dashboard-icon {
        background: linear-gradient(135deg, #6366f1, #4338ca);
    }

    .dashboard-booking-status {
        font-size: 0.93rem;
        color: #6b7280;
        margin-top: 0.2rem;
    }

        .dashboard-booking-status strong {
            color: #22223b;
        }

    .card {
        border-radius: 1.25rem !important;
        border: none;
        background: #fff;
        box-shadow: 0 2px 16px rgba(60,72,88,0.07);
    }

        .card h5 {
            font-weight: 700;
            color: #374151;
            letter-spacing: 0.2px;
        }

    .table thead th {
        background: #f3f4f6 !important;
        color: #374151;
        font-weight: 700;
        border: none;
    }

    .table-striped > tbody > tr:nth-of-type(odd) {
        background: #f9fafb;
    }

    .admin-avatar {
        width: 2.1rem;
        height: 2.1rem;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 0.6rem;
        border: 2px solid #e0e7ff;
        background: #e0e7ff;
    }

    .badge-action {
        font-size: 0.92rem;
        border-radius: 1rem;
        padding: 0.25em 0.8em;
        font-weight: 600;
        background: #e0e7ff;
        color: #6366f1;
    }

        .badge-action[data-action="Delete"] {
            background: #fee2e2;
            color: #dc2626;
        }

        .badge-action[data-action="Update"] {
            background: #fef9c3;
            color: #ca8a04;
        }

        .badge-action[data-action="Create"] {
            background: #d1fae5;
            color: #059669;
        }

        .badge-action[data-action="Login"] {
            background: #e0e7ff;
            color: #6366f1;
        }

    .table td, .table th {
        vertical-align: middle;
    }
   

    .dashboard-icon {
        font-size: 1.5rem;
        width: 2.5rem;
        height: 2.5rem;
    }

    .dashboard-value {
        font-size: 1.3rem;
    }

    }
</style>

<div class="container py-4">
    <div class="d-flex align-items-center mb-4">
        <i class="bi bi-speedometer2 fs-2 text-primary me-3"></i>
        <span class="dashboard-title">Admin Dashboard</span>
    </div>

    <!-- Cards -->
    <div class="row g-4 mb-5">
        <div class="col-md-2 col-6">
            <div class="dashboard-card bg-gradient-users text-center">
                <div class="dashboard-icon"><i class="bi bi-people-fill"></i></div>
                <div class="dashboard-label">Users</div>
                <div class="dashboard-value">@ViewBag.TotalUsers</div>
                <a asp-action="Users" class="btn">Manage</a>
            </div>
        </div>
        <div class="col-md-2 col-6">
            <div class="dashboard-card bg-gradient-hotels text-center">
                <div class="dashboard-icon"><i class="bi bi-building"></i></div>
                <div class="dashboard-label">Hotels</div>
                <div class="dashboard-value">@ViewBag.TotalHotels</div>
                <a asp-action="Hotels" class="btn">Manage</a>
            </div>
        </div>
        <div class="col-md-2 col-6">
            <div class="dashboard-card bg-gradient-rooms text-center">
                <div class="dashboard-icon"><i class="bi bi-door-closed"></i></div>
                <div class="dashboard-label">Rooms</div>
                <div class="dashboard-value">@ViewBag.TotalRooms</div>
                <a asp-action="Rooms" class="btn">Manage</a>
            </div>
        </div>
        <div class="col-md-2 col-6">
            <div class="dashboard-card bg-gradient-amenities text-center">
                <div class="dashboard-icon"><i class="bi bi-gem"></i></div>
                <div class="dashboard-label">Amenities</div>
                <div class="dashboard-value">@ViewBag.TotalAmenities</div>
                <a asp-action="Amenities" class="btn">Manage</a>
            </div>
        </div>
        <div class="col-md-2 col-6">
            <div class="dashboard-card bg-gradient-vouchers text-center">
                <div class="dashboard-icon"><i class="bi bi-ticket-perforated"></i></div>
                <div class="dashboard-label">Vouchers</div>
                <div class="dashboard-value">@ViewBag.TotalVouchers</div>
                <a asp-action="Vouchers" class="btn">Manage</a>
            </div>
        </div>
        <div class="col-md-2 col-6">
            <div class="dashboard-card bg-gradient-bookings text-center">
                <div class="dashboard-icon"><i class="bi bi-journal-check"></i></div>
                <div class="dashboard-label">Bookings</div>
                <div class="dashboard-value">@ViewBag.TotalBookings</div>
                <div class="dashboard-booking-status">
                    Paid: <strong>@ViewBag.PaidBookings</strong> |
                    Pending: <strong>@ViewBag.PendingBookings</strong> |
                    Cancelled: <strong>@ViewBag.CancelledBookings</strong>
                </div>
                <a asp-action="ManageBookings" class="btn">Manage</a>
            </div>
        </div>
    </div>

    <!-- Charts -->
    <div class="row g-4">
        <div class="col-lg-6">
            <div class="card shadow-sm p-4">
                <h5 class="mb-3 text-center">System Overview</h5>
                <canvas id="overviewChart" height="200" style="border-radius:1rem;box-shadow:0 2px 12px rgba(99,102,241,0.07);"></canvas>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card shadow-sm p-4">
                <h5 class="mb-3 text-center">Bookings (Last 7 days)</h5>
                <canvas id="bookingChart" height="200" style="border-radius:1rem;box-shadow:0 2px 12px rgba(59,130,246,0.07);"></canvas>
            </div>
        </div>
    </div>
    <!-- Admin Logs -->
    <div class="row g-4 mt-4">
        <div class="col-12">
            <div class="card shadow-sm p-4">
                <h5 class="mb-3 text-center">
                    <i class="bi bi-clipboard-data me-2"></i> Admin Action Logs (Gần đây)
                </h5>
                <div class="table-responsive">
                    <table class="table table-striped table-bordered align-middle">
                        <thead>
                            <tr>
                                <th>Thời gian</th>
                                <th>Admin</th>
                                <th>Action</th>
                                <th>Controller</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (ViewBag.AdminLogs != null)
                            {
                                foreach (var log in (IEnumerable<BoookingHotels.Models.AdminLog>)ViewBag.AdminLogs)
                                {
                                    <tr>
                                        <td>@log.CreatedAt.ToString("dd/MM/yyyy HH:mm:ss")</td>
                                        <td>
                                            @log.Admin (@log.AdminId)
                                        </td>
                                        <td>
                                            <span class="badge-action" data-action="@log.Action">@log.Action</span>
                                        </td>
                                        <td>@log.Description</td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="4" class="text-center text-muted">Chưa có log nào.</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    // Overview Chart
    var ctxOverview = document.getElementById('overviewChart').getContext('2d');
    var overviewChart = new Chart(ctxOverview, {
        type: 'doughnut', // có thể đổi sang 'bar' / 'pie'
        data: {
            labels: ['Users', 'Hotels', 'Rooms', 'Amenities', 'Vouchers', 'Bookings'],
            datasets: [{
                data: [
                    @ViewBag.TotalUsers,
                    @ViewBag.TotalHotels,
                    @ViewBag.TotalRooms,
                    @ViewBag.TotalAmenities,
                    @ViewBag.TotalVouchers,
                    @ViewBag.TotalBookings
                ],
                backgroundColor: [
                    '#6366f1', '#34d399', '#fbbf24',
                    '#f472b6', '#ec4899', '#3b82f6'
                ]
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'bottom' }
            }
        }
    });

    // Booking Chart (7 ngày gần nhất)
    var ctxBooking = document.getElementById('bookingChart').getContext('2d');
    var bookingChart = new Chart(ctxBooking, {
        type: 'line',
        data: {
            labels: @Html.Raw(Json.Serialize(ViewBag.BookingDates)),
            datasets: [
                {
                    label: 'Số lượng booking',
                    data: @Html.Raw(Json.Serialize(ViewBag.BookingCounts)),
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59,130,246,0.2)',
                    fill: true,
                    tension: 0.4
                },
                {
                    label: 'Doanh thu',
                    data: @Html.Raw(Json.Serialize(ViewBag.BookingTotals)),
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16,185,129,0.2)',
                    fill: true,
                    tension: 0.4
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'bottom' }
            },
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>
